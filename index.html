<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Mini E-commerce Demo</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f5f5f5;
    color: #333;
    margin: 0;
    padding: 20px;
  }
  h1, h2 {
    text-align: center;
    color: #222;
  }
  .container {
    display: flex;
    gap: 40px;
    justify-content: center;
    flex-wrap: wrap;
  }
  ul#products {
    list-style: none;
    padding: 0;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 20px;
    max-width: 900px;
  }
  li {
    background: white;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    text-align: center;
  }
  button {
    background: #007bff;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 6px 12px;
    cursor: pointer;
    font-size: 14px;
  }
  button:hover {
    background: #0056b3;
  }
  #cart-container {
    background: white;
    padding: 20px;
    border-radius: 10px;
    max-width: 400px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  .cart-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }
  .cart-item button {
    padding: 2px 8px;
    font-size: 12px;
  }
  #total {
    font-weight: bold;
    margin-top: 10px;
    text-align: right;
  }
  #place {
    display: block;
    margin: 15px auto 0 auto;
    background: #28a745;
  }
  #place:hover {
    background: #218838;
  }
</style>
</head>
<body>

<h1>üõçÔ∏è Mini E-commerce Demo</h1>

<div class="container">
  <div>
    <h2>Products</h2>
    <ul id="products"></ul>
  </div>

  <div id="cart-container">
    <h2>Cart</h2>
    <div id="cart"></div>
    <div id="total"></div>
    <button id="place">Place Order</button>
  </div>
</div>

<script>
const API = 'http://localhost:5000';
let products = [];
let cart = [];

async function load() {
  const r = await fetch(API + '/products');
  products = await r.json();
  const ul = document.getElementById('products');
  ul.innerHTML = '';
  
  products.forEach(p => {
    const li = document.createElement('li');
    li.innerHTML = `<strong>${p.name}</strong><br>$${p.price}<br><small>Stock: ${p.stock}</small><br>`;
    
    const btn = document.createElement('button');
    btn.innerText = 'Add to Cart';
    btn.onclick = () => addToCart(p);
    
    li.appendChild(btn);
    ul.appendChild(li);
  });
}

function addToCart(product) {
  const existing = cart.find(i => i.productId === product.id);
  if (existing) {
    if (existing.quantity < product.stock) existing.quantity++;
    else return alert('Out of stock!');
  } else {
    cart.push({ productId: product.id, name: product.name, price: product.price, quantity: 1 });
  }
  renderCart();
}

function updateQuantity(id, change) {
  const item = cart.find(i => i.productId === id);
  if (!item) return;
  item.quantity += change;
  if (item.quantity <= 0) cart = cart.filter(i => i.productId !== id);
  renderCart();
}

function renderCart() {
  const cartDiv = document.getElementById('cart');
  cartDiv.innerHTML = '';
  
  if (cart.length === 0) {
    cartDiv.innerHTML = '<p>Your cart is empty.</p>';
    document.getElementById('total').innerText = '';
    return;
  }

  cart.forEach(item => {
    const div = document.createElement('div');
    div.className = 'cart-item';
    div.innerHTML = `
      ${item.name} - $${item.price} √ó ${item.quantity}
      <div>
        <button onclick="updateQuantity(${item.productId}, -1)">-</button>
        <button onclick="updateQuantity(${item.productId}, 1)">+</button>
      </div>
    `;
    cartDiv.appendChild(div);
  });

  const total = cart.reduce((sum, i) => sum + i.price * i.quantity, 0);
  document.getElementById('total').innerText = 'Total: $' + total.toFixed(2);
}

document.getElementById('place').onclick = async () => {
  if (cart.length === 0) return alert('Cart is empty!');
  
  const r = await fetch(API + '/orders', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ items: cart })
  });
  
  if (!r.ok) {
    const e = await r.json();
    return alert('Error: ' + JSON.stringify(e));
  }

  const data = await r.json();
  alert('‚úÖ Order placed successfully! Order ID: ' + data.id);
  
  cart = [];
  renderCart();
  load();
};

load();
</script>

</body>
</html>
